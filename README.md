# The History Cleañar(ザ・ヒストリークリーニャー)
## プロジェクト概要
プログラミング職業訓練の卒業制作として、個人で制作したトップダウン視点のオリジナル2Dゲーム。  
夜の博物館で働く猫型清掃ロボが暴走を起こし、展示品を次々壊して回ります。館内に配置された警備員から逃げつつ。どれだけ「損額損額」を稼げるか競う背徳感に溢れたゲームです。  
  
![The History Cleañarタイトル画像](readme_img/Title.png)  
![館内マップ](readme_img/Map.png)  

## サンプルゲーム
ぜひゲームを体験してみてください！  
[RoboSurvivorサンプル](https://arai1571.github.io/TheHistoryCleaner_PlayWeb/)

## 操作方法
前後・左右　移動：WASDキー、または矢印キー  
モップアタック・ブリーチスプレー：スペースキー  
消化器攻撃：左シフトキー 
説明を読む：Eキー

## 注意
* 追いかけてくる警備員に消化器を投げつけると煙が発生し、警備んの動きを一時的に止めることができます。
![UI説明](readme_img/Smoke.png) 
* 陶磁器を壊す時はモップアタック、絵画を破壊する時はブリーチスプレーが自動で切り替わります。
* プレイヤーにもHPがあり、歩行、攻撃のたびに少しづつHPが減っていきます。HP0でゲームオーバーとなるので注意！ 
* 館内に置いてあるオイルを拾うとHPが100パーセントまで一気に回復します。 
* 警備員に捕まると、1発アウトでゲームオーバーとなります。
![UI説明](readme_img/GameOver.png)  


## 制作について
* 制作期間：20日間 
* 使用エンジン：Unity Editorバージョン 6000.0.54f1 
* 使用言語：C#  
* 使用アセット：
itch.io→美術館のタイル素材、展示品や警備員のアセットの購入先
* BGM、SE：
dova-s.jp->bgm
効果音ラボ->ロボットの操作音などのSE
どうぶつ語音声ジェネレーター->オップニングシーンで猫型ロボットたちの音声を生成
* Fontデータ： Noto Sans JP-Medium SDF (TMP_Font Asset)  
* デザインツール：Adobe Illustrator、Adobe Photoshop
* そのほかの使用ツール：GitHub、SorceTree、Visual Studio Code


## ゲームフロー
* オープニングシーン  
ストーリーに入り込むために、「バグが起こって暴走してしまう猫ロボ」が伝わる演出を狙いました。あえて説明を明確に行わないことで、プレイスタートしてから詳細がわかってくる楽しさを残しています。 
![オープニング画面](readme_img/Opening1.png)  
![オープニング画面](readme_img/Opening2.png) 
![オープニング画面](readme_img/Opening3.png)  

* エントランス（操作パート）  
薄暗い館内に置いてあるスポットライトを拾い進みます。ライトの近くに消化器が置いてあり、近づくと操作方法などの説明を読むことができます。入り口ゲートをくぐって、館内に入室します。
![エントランス画像]()  
  
* 陶磁器ブース（操作パート）   
陶磁器の破壊可能な領域に入ると、陶磁器のHPパラメーターが表示されます。全て赤に変わるまで、スペースキーを押し、粉々になるまで破壊しましょう！大きな陶磁器は叩く回数がより必要です。大きさ・色によって獲得損害額も異なります。
![陶磁器ブース画像](readme_img/Pottery0.png)
![陶磁器ブース画像](readme_img/Pottery1.png)
![陶磁器ブース画像](readme_img/Pottery2.png)
![陶磁器ブース画像](readme_img/PotteryArea.png)

* 絵画ブース （操作パート）
陶磁器と同じように、絵画にもHPパラメーターが表示されます。ブリーチスプレーを一度行えば損害額を獲得！有名なものほど高額な損害額をゲットできます。
![絵画ブース画像](readme_img/Paint1.png)
![絵画ブース画像](readme_img/Paint2.png)
![絵画ブース画像](readme_img/PaintingsArea.png)  

* モナリザブース （BOSS:操作パート） 
警備員が多く配置されたブースを進み、モナリザにブリーチスプレーをかけます。このブースはスルーしてゴールゲートで直行することも可能です。難易度が高いので、その分、獲得損害額も高く設定されています。
![エンディング画像](readme_img/Boss.png)  

* エンディングシーン  
エンディングではニュース速報のSEやBGMにあわせて、獲得損害総額が表示されます。ゲームオーバーになった場合でもその時点での総額が表示されます。
![エンディング画像](readme_img/Ending.png)  
  

### Player 3つのアクション  
Playerの猫型清掃ロボには、展示品に応じた２つの攻撃方法と、警備員に対する攻撃の合計３つの攻撃手段を持たせています。
* モップアタック（陶磁器の破壊用）  
* ブリーチスプレー（絵画の破壊用）  
* 消化器シュート（警備員の足止め用）  
それぞれアクションにあわせたコルーチンを構築し、繰り返し（UpDate）の中でプレイヤーの距離に応じたコルーチンを選択してきます。  
  
```C#
void Update()
    {
        //ゲーム状態がプレイ中でなければ何もしない
        if (GameManager.gameState != GameState.playing) return;
        if (bossHP <= 0) return;
        if (player == null) return;

        // ダメージ中の点滅処理
        if (isDamage)
        {
            Blinking();
        }

        if (isAttacking) return; // 攻撃中は処理をスキップ


        timer += Time.deltaTime; //ゲームの経過時間

        //プレイヤーとの距離を測る
        float distanceToPlayer = Vector3.Distance(transform.position, player.transform.position);

        // 攻撃のクールダウン
        if (timer >= attackInterval)
        {
            isAttacking = true; //攻撃中フラグをON
            if (distanceToPlayer <= closeRange)　// Playerが近い時
            {
                // バリアを展開
                StartCoroutine(ActivateBarrier());
            }
            else　// Playerが遠い時 (detectionRange内)
            {
                // タックルか球を飛ばすかをランダムで決定
                int randomAction = Random.Range(0, 2); // 0: タックル, 1: 球を飛ばす

                if (randomAction == 0)
                {
                    StartCoroutine(Tackle());　//タックル
                }
                else
                {
                    StartCoroutine(ShootProjectile()); //シュート
                }
            }
            timer = 0; //リセット
        }
    }
```
  
<!-- ### 倒したときの爽快感
アクションゲームとして緊張感のあるバトルの末に撃破した爽快感、達成感が大切だと思います。  
担当したボスは撃破時に爆発エフェクトがおきるので、倒したという実感をしっかりを感じることができます。  
また、倒してからエンディングまでにプレイヤーに達成感と余韻を残すことで、もう一度プレイしてみたくなるような手応えを目指しました。  
  
![爆発](readme_img/robo_readme_8.png)  

```C#
 //HPがなくなったら削除
if (bossHP <= 0)
{
    //爆発音を鳴らす
    audioSource.PlayOneShot(se_Explosion);

    //爆発エフェクトの生成
    GameObject obj = Instantiate(
        explosionPrefab,
        transform.position,
        Quaternion.identity
        );

    obj.transform.SetParent(transform); //爆発がボスについていくように
    Destroy(gameObject, 1.0f); //エフェクト分1秒まってからボスの消失

    //消滅からゲームステータスが変わるまでの時間差コルーチン
    StartCoroutine(BossDestroy());
}

//撃破からエンディングにいくまでの時間差（余韻）
IEnumerator BossDestroy()
{
    yield return new WaitForSeconds(5.0f); //5秒待つ
    GameManager.gameState = GameState.gameclear; //ゲームステータスを変更してエンディングへ
}
```
## 共同開発におけるレビューを行いブラッシュアップ
まずは最初の2日間でプロトタイプを完成させるために担当箇所を構築しました。  
それぞれの担当箇所をGitHubを活用してマージし、当日デバッグに回れるメンバーでデバッグプレイしてプロトタイプへの評価を行いました。  
この評価に関してチームミーティングを行い、改善点と改善方法を定め残りの2日間で調整を行うことでブラッシュアップできました。  
  
![デバッグ評価](readme_img/team_review_d.png)  
  
## GitHub上でのマージ作業を意識して担当範囲に最新の注意
スピードが要求される制作期間において、マージ作業で大きなトラブルを生まないようチームの取り決めを忠実に順守しました。  
GitHubのIssuesを通じて進捗や問題点については随時チームへの報告や問題提起を行っています。
![issuesにおける情報共有](readme_img/team_issues_d.png)  
  
SourceTreeでブランチを分けてコンクリフト衝突がおこらないよう細心の注意を払いました。  
また定期的なコミットを通してバックアップも万全にしました。  
![SourceTreeの様子](readme_img/team_sourcetree_d.png)  
  
## 共同開発に関する工夫
### 仕様から反れていないかの確認作業
チームの打ち合わせで大体の方向性・仕様はあったものの、細かい部分は自身の考えに委ねられる環境でした。  
私の場合はとにかくユーザーが爽快に何回でもバトルしてみたくなる手応えを大事にしましたので、SEによる臨場感やシーン切り替えのタイミングなどを気にしました。  
一方でこだわった結果、チームとして想定された仕様や方向性から逸脱していないかも心配な部分でしたので、疑問に思った部分はチームリーダーにマメに確認をとり、マージする際の影響なども考えながら慎重に改良を重ねることができました。  
  
例えば、当時の心配ごととして、気軽に斬撃で勝てないよう近づきすぎるとボス本体からダメージ判定をもらうのを是としていたのですが、これが仕様上問題ないかはきちんと確認をいれました。  
  
### 細かいコミット作業
とにかく自分のデータにトラブルがあると、全体に影響が出てしまうので何か大きな変更を行う際にはコミットによるバージョン管理によって、いつでももとに戻れるように気を使いました。  
またコミットだけではなくプッシュを意識してクラウドにバックアップが常にある状態の維持に努めました。  
  
特にボスがタックルしてくるコルーチン制作には調整に大変苦労しましたので、コードにコメントを多く残すと同時に確実にコミットとプッシュしていくよう意識しました。
  
### 納期の意識
チーム開発ということで自分のせいで周りに影響がでないよう良い意味でプレッシャーを感じていたのですが、それ以上にこれをプレイするユーザーを意識して時間内に必ず間に合わせるという意識を大切にしました。そのために何日に何ができていないといけないという逆算に加え、さらに半日～1日余裕をもたせるようにスケジューリングしました。  
詰まってしまったところは、自分でこだわる部分とそうでない部分を「納期に間に合うか」で天秤にかけることで、リーダーに助力を乞うタイミングは基準を決めやすかったです。  
  
具体的にはボスのバリア展開について細部がどうしても腑に落ちず、自分でも追及したい気持ちが高かったのですが中間のプロトタイプまで時間が迫っていたので、逆に早めにリーダーに確認をすることとし、その代わり解説してもらった原理は徹底的に理解するように努めました。  
  
### AIの活用
自分で考えれる部分は多かったのですが、一部時短もかねてAIを大いに活用しました。  
しかし、AIが出したコードだけでは不十分なものも多かったので、大枠はAIの案を採用しつつも細部は自分で修正するという作業をしたことで出だしが早く無事納期に間に合わすことができたと思います。  
* 仕様ツール：Google AI Studio　「Gemini 2.5 Pro」

## 今後の課題
他の担当者のパートも含めゲーム全体の内容を理解はしていますが、上空を飛び交うヘリのようなNavMeshAgentコンポーネントを活用しづらいコードについては未挑戦なので、ぜひ次回以降に作ってみようと思います。  
調べたところ、いくつかの方法のうちエネミーのルーティングを行うのが一番自然だと感じましたので挑戦してみます。  
[参考サイト：Unity入門の森/移動経路の構築とOnDrawGizmosによる移動経路の可視化](https://feynman.co.jp/unityforest/game-create-lesson/tower-defense-game/enemy-route/)
  
![ヘリのイメージ映像](readme_img/future_image.png)   --> 